# Система компьютерного зрения для FPV

## Описание проекта

Система компьютерного зрения для FPV (First Person View) приложений с использованием нейронной сети YOLOv8. Система специально адаптирована для использования на летательных аппаратах и обеспечивает стабильное обнаружение объектов в реальном времени, их отслеживание и определение положения в 3D пространстве.

## Основные возможности

- Захват видео в реальном времени через FPV камеру
- Стабилизация изображения для компенсации движения дрона
- Обнаружение объектов с помощью нейросети YOLOv8
- Отслеживание нескольких объектов с уникальными ID
- Определение 3D координат объектов
- Визуализация траектории движения объектов
- Поддержка более 80 классов объектов
- Адаптивное улучшение изображения при плохом освещении
- Автоматическая настройка яркости и контраста
- Шумоподавление для улучшения качества распознавания

## Особенности использования на летательных аппаратах

- **Стабилизация изображения**:
  - Компенсация вибраций и движений дрона
  - Использование оптического потока для отслеживания движения
  - Адаптивная подстройка под скорость движения

- **3D позиционирование**:
  - Определение координат объектов в пространстве (X, Y, Z)
  - Учет углов наклона камеры
  - Расчет относительного положения объектов

- **Калибровка для полета**:
  - Настройка параметров камеры (FOV, фокусное расстояние)
  - Учет высоты полета
  - Адаптация к скорости движения

## Системные требования

- FPV камера с низкой задержкой
- Python 3.7 или новее
- Windows/Linux
- Рекомендуется одноплатный компьютер с GPU (например, Jetson Nano)

## Необходимые библиотеки

- OpenCV - для работы с видео и стабилизации
- PyTorch - для работы нейросети
- Ultralytics YOLOv8 - для распознавания объектов
- NumPy - для математических вычислений
- imutils - для обработки изображений

## Установка на летательный аппарат

### 1. Установка и подключение камеры

1. **Выбор камеры**:
   - Рекомендуется использовать FPV камеру с низкой задержкой (latency < 50ms)
   - Разрешение: минимум 640x480 пикселей
   - Угол обзора: рекомендуется 60-90 градусов
   - Поддержка автофокуса желательна

2. **Монтаж камеры**:
   - Установите камеру на переднюю часть дрона
   - Используйте антивибрационную платформу или демпферы
   - Убедитесь, что пропеллеры не попадают в поле зрения
   - Угол наклона камеры: 15-30 градусов вниз для оптимального обзора
   - Защитите линзу от попадания пыли и влаги

3. **Подключение камеры**:
   - Используйте экранированный кабель для передачи видеосигнала
   - Обеспечьте надежную фиксацию разъемов
   - При необходимости используйте USB-удлинитель с ферритовыми кольцами

### 2. Установка одноплатного компьютера

1. **Подготовка Jetson Nano (или аналога)**:
   - Рекомендуемая модель: Jetson Nano 4GB Developer Kit
   - Установите радиатор охлаждения
   - При необходимости добавьте активное охлаждение (вентилятор)

2. **Монтаж компьютера**:
   - Расположите компьютер в центре масс дрона
   - Используйте антивибрационную платформу:
     * Силиконовые демпферы
     * Резиновые прокладки
     * Специальные антивибрационные стойки
   - Обеспечьте доступ воздуха для охлаждения
   - Защитите от влаги и пыли (рекомендуется использовать защитный кейс)

3. **Организация питания**:
   - Используйте стабилизатор напряжения 5В
   - Рекомендуемая мощность БП: минимум 2А (10Вт)
   - Установите конденсаторы для фильтрации помех
   - Используйте отдельную линию питания от аккумулятора

4. **Подключение периферии**:
   - Подключите камеру через USB 3.0 порт
   - При необходимости установите Wi-Fi антенну
   - Подключите GPS модуль (опционально)
   - Обеспечьте надежную фиксацию всех кабелей

### 3. Проверка установки

1. **Механическая проверка**:
   - Проверьте надежность всех креплений
   - Убедитесь в отсутствии люфтов
   - Проверьте балансировку дрона

2. **Электрическая проверка**:
   - Измерьте напряжение питания компьютера
   - Проверьте качество видеосигнала
   - Убедитесь в отсутствии помех от моторов

3. **Тестирование системы**:
   - Проведите наземное тестирование
   - Проверьте температуру компьютера
   - Убедитесь в стабильности видеопотока

### 4. Настройка программного обеспечения

1. Установите Python и зависимости:
```bash
pip install -r requirements.txt
```

2. Откалибруйте параметры камеры:
   - Измерьте реальные углы обзора
   - Настройте фокусное расстояние
   - Проверьте точность определения расстояния

## Использование в полете

1. Подключите FPV камеру к бортовому компьютеру

2. Запустите систему:
```bash
python fpv_vision.py
```

3. Система будет:
   - Стабилизировать изображение с камеры
   - Определять объекты в поле зрения
   - Показывать их 3D координаты
   - Отслеживать траектории движения
   - Компенсировать движение дрона

4. Для выхода нажмите 'q'

## Настройка параметров

В коде можно настроить следующие параметры:

- `self.focal_length` - фокусное расстояние камеры
- `self.fov_horizontal` - горизонтальный угол обзора
- `self.fov_vertical` - вертикальный угол обзора
- `self.brightness_threshold` - порог яркости
- Параметры стабилизации в `self.lk_params`

## Рекомендации по использованию

1. **Монтаж оборудования**:
   - Используйте демпферы для уменьшения вибраций
   - Располагайте камеру так, чтобы пропеллеры не попадали в кадр
   - Обеспечьте надежную фиксацию всех компонентов

2. **Настройка системы**:
   - Проведите калибровку камеры перед первым использованием
   - Настройте параметры стабилизации под ваш дрон
   - Протестируйте систему на разных высотах и скоростях

3. **Оптимизация производительности**:
   - Используйте режим малого разрешения для увеличения FPS
   - Выберите подходящую модель YOLOv8 (n/s/m/l/x)
   - Настройте параметры обработки изображения

## Примечания

- Точность определения расстояния зависит от калибровки камеры
- При высокой скорости полета может потребоваться дополнительная настройка стабилизации
- Система автоматически адаптируется к условиям освещения
- Производительность зависит от мощности бортового компьютера
- Рекомендуется периодическая проверка калибровки

## Описание функций

- **Обнаружение объектов**: 
  - Использует YOLOv8 для определения более 80 различных типов объектов
  - Показывает процент уверенности в определении
  - Выделяет объекты зеленой рамкой

- **Отслеживание объектов**: 
  - Присваивает каждому объекту уникальный ID
  - Сохраняет историю перемещений
  - Отображает траекторию движения желтой линией

- **Оценка расстояния**: 
  - Вычисляет примерное расстояние до объекта
  - Использует параметры камеры и размер объекта
  - Показывает расстояние в сантиметрах

- **Улучшение изображения**:
  - Автоматическое определение уровня освещенности
  - Адаптивное повышение яркости при плохом освещении
  - Улучшение контраста с помощью CLAHE
  - Интеллектуальное шумоподавление
  - Сохранение цветового баланса


